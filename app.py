import streamlit as st
import numpy as np
import joblib

# --------------------------------------------------
# Page Configuration
# --------------------------------------------------
st.set_page_config(
    page_title="Predictive Maintenance System",
    layout="wide"
)

# --------------------------------------------------
# Header
# --------------------------------------------------
st.title("Predictive Maintenance System")
st.write(
    """
    This application predicts **machine operating condition** based on 
    real-time sensor and operational parameters using a trained 
    machine learning model.
    """
)

st.divider()

# --------------------------------------------------
# Load Model and Scaler
# --------------------------------------------------
@st.cache_resource
def load_artifacts():
    model = joblib.load("svm_predictive_maintenance_model.pkl")
    scaler = joblib.load("scaler.pkl")
    return model, scaler

model, scaler = load_artifacts()

# --------------------------------------------------
# Input Section
# --------------------------------------------------
st.subheader("Machine Input Parameters")

with st.form("prediction_form"):
    col1, col2 = st.columns(2)

    with col1:
        air_temp = st.number_input(
            "Air Temperature (K)",
            min_value=250.0,
            max_value=400.0,
            value=300.0
        )
        process_temp = st.number_input(
            "Process Temperature (K)",
            min_value=250.0,
            max_value=450.0,
            value=310.0
        )
        rotational_speed = st.number_input(
            "Rotational Speed (rpm)",
            min_value=500.0,
            max_value=5000.0,
            value=1500.0
        )

    with col2:
        torque = st.number_input(
            "Torque (Nm)",
            min_value=0.0,
            max_value=200.0,
            value=40.0
        )
        tool_wear = st.number_input(
            "Tool Wear (minutes)",
            min_value=0.0,
            max_value=300.0,
            value=100.0
        )

    submitted = st.form_submit_button("Run Prediction")

# --------------------------------------------------
# Prediction Logic
# --------------------------------------------------
if submitted:
    input_features = np.array([[
        air_temp,
        process_temp,
        rotational_speed,
        torque,
        tool_wear
    ]])

    input_scaled = scaler.transform(input_features)
    prediction = model.predict(input_scaled)[0]

    st.divider()
    st.subheader("Prediction Result")

    if prediction == 0:
        st.success("Machine Status: **Normal Operation**")
    else:
        st.error("Machine Status: **Failure Risk Detected**")

    st.caption(
        "Note: This prediction is generated by a statistical model and "
        "should support — not replace — engineering judgment." 
        "   **OOU-IBOGUN MECHANICAL ENGINEERING 300-LEVEL**"
    )



